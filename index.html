<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REACH 2.0 - Recovery Starts Here</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'teal': {
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .screen {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease-in-out;
        }
        .screen.active {
            opacity: 1;
            transform: translateY(0);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar {
            background: linear-gradient(90deg, #14b8a6 0%, #14b8a6 16.67%, #e5e7eb 16.67%, #e5e7eb 100%);
        }
        .chat-bubble-sent {
            background: #14b8a6;
            color: white;
            margin-left: 20%;
            border-radius: 18px 18px 4px 18px;
        }
        .chat-bubble-received {
            background: #f3f4f6;
            color: #374151;
            margin-right: 20%;
            border-radius: 18px 18px 18px 4px;
        }
        .points-badge {
            background: linear-gradient(45deg, #10b981, #14b8a6);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .roulette-spin {
            transition: transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .tour-modal {
            animation: tourSlideIn 0.3s ease-out;
        }
        @keyframes tourSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tour-spotlight {
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
        }
        .roulette-wheel {
            position: relative;
            width: 16rem;
            height: 16rem;
            border-radius: 50%;
            border: 8px solid #d1d5db;
            background: conic-gradient(from 0deg,
                #ef4444 0deg 36deg,     /* $5 - 10% */
                #22c55e 36deg 72deg,    /* $10 - 10% */
                #ef4444 72deg 108deg,   /* $5 - 10% */
                #22c55e 108deg 144deg,  /* $15 - 10% */
                #ef4444 144deg 180deg,  /* $5 - 10% */
                #22c55e 180deg 216deg,  /* $10 - 10% */
                #ef4444 216deg 252deg,  /* $5 - 10% */
                #8b5cf6 252deg 288deg,  /* $25 - 10% */
                #ef4444 288deg 324deg,  /* $5 - 10% */
                #f59e0b 324deg 360deg   /* $30 - 10% */
            );
            transition: transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .roulette-numbers {
            position: absolute;
            inset: 0;
            border-radius: 50%;
        }
        .roulette-number {
            position: absolute;
            color: white;
            font-weight: bold;
            font-size: 0.875rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            top: 50%;
            left: 50%;
        }
        /* Position numbers at the center of each color section */
        .roulette-number:nth-child(1) { transform: translate(-50%, -50%) rotate(18deg) translateY(-5rem) rotate(-18deg); }   /* $5 at 18¬∞ */
        .roulette-number:nth-child(2) { transform: translate(-50%, -50%) rotate(54deg) translateY(-5rem) rotate(-54deg); }   /* $10 at 54¬∞ */
        .roulette-number:nth-child(3) { transform: translate(-50%, -50%) rotate(90deg) translateY(-5rem) rotate(-90deg); }   /* $5 at 90¬∞ */
        .roulette-number:nth-child(4) { transform: translate(-50%, -50%) rotate(126deg) translateY(-5rem) rotate(-126deg); } /* $15 at 126¬∞ */
        .roulette-number:nth-child(5) { transform: translate(-50%, -50%) rotate(162deg) translateY(-5rem) rotate(-162deg); } /* $5 at 162¬∞ */
        .roulette-number:nth-child(6) { transform: translate(-50%, -50%) rotate(198deg) translateY(-5rem) rotate(-198deg); } /* $10 at 198¬∞ */
        .roulette-number:nth-child(7) { transform: translate(-50%, -50%) rotate(234deg) translateY(-5rem) rotate(-234deg); } /* $5 at 234¬∞ */
        .roulette-number:nth-child(8) { transform: translate(-50%, -50%) rotate(270deg) translateY(-5rem) rotate(-270deg); } /* $25 at 270¬∞ */
        .roulette-number:nth-child(9) { transform: translate(-50%, -50%) rotate(306deg) translateY(-5rem) rotate(-306deg); } /* $5 at 306¬∞ */
        .roulette-number:nth-child(10) { transform: translate(-50%, -50%) rotate(342deg) translateY(-5rem) rotate(-342deg); } /* $30 at 342¬∞ */
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="max-w-sm mx-auto bg-white min-h-screen shadow-lg relative">
        
        <!-- Welcome Screen -->
        <section id="welcome" class="screen active p-8 text-center h-screen flex flex-col justify-center">
            <div class="mb-12">
                <div class="w-20 h-20 bg-teal-500 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-3xl text-white">üíä</span>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Recovery Starts Here</h1>
                <p class="text-gray-600 text-lg">Scan your first test, earn your first reward</p>
            </div>
            <button onclick="navigateTo('intake')" class="w-full bg-teal-500 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:bg-teal-600 transition-colors">
                Begin in ED
            </button>
        </section>

        <!-- Quick Intake Screen -->
        <section id="intake" class="screen p-6 h-screen flex flex-col">
            <div class="mb-6">
                <button onclick="navigateTo('welcome')" class="text-teal-500 mb-4">‚Üê Back</button>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Quick Intake</h2>
                <p class="text-sm text-gray-600">Complete this to earn your first 10 points!</p>
            </div>
            
            <div class="flex-1 space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Patient Name</label>
                    <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500" placeholder="Enter patient's full name">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Medicaid ID</label>
                    <div class="flex space-x-2">
                        <input type="text" id="medicaidInput" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500" placeholder="Enter Medicaid ID">
                        <button onclick="checkEligibility()" class="bg-blue-500 text-white px-4 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                            Verify
                        </button>
                    </div>
                    <div id="eligibilityResult" class="mt-2 hidden">
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <span class="text-green-600">‚úÖ</span>
                                <div class="text-sm">
                                    <p class="font-semibold text-green-800">Eligible - Targeted Adult Medicaid</p>
                                    <p class="text-green-600">Route: FFS Medicaid (H0038)</p>
                                    <p class="text-green-600">County: Salt Lake | No PMHP enrollment</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ethnicity</label>
                    <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                        <option>Select ethnicity</option>
                        <option>Hispanic or Latino</option>
                        <option>Not Hispanic or Latino</option>
                        <option>Prefer not to answer</option>
                    </select>
                </div>
            </div>
            
            <button onclick="navigateTo('success')" class="w-full bg-teal-500 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:bg-teal-600 transition-colors">
                Continue
            </button>
        </section>

        <!-- Success + Interactive Tour Screen -->
        <section id="success" class="screen p-6 h-screen flex flex-col">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">üéâ</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Nice work!</h2>
                <div class="points-badge text-white py-2 px-4 rounded-full inline-block mb-4">
                    <span class="font-bold">+10 Points Earned!</span>
                </div>
                <p class="text-sm text-gray-600">Points unlock rewards and prizes</p>
            </div>
            
            <!-- Interactive Tour Launch -->
            <div class="flex-1 mb-6 flex flex-col justify-center">
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl p-6 text-white text-center">
                    <div class="text-4xl mb-3">üéØ</div>
                    <h3 class="text-lg font-bold mb-2">Ready to explore Moonlit?</h3>
                    <p class="text-sm mb-4 opacity-90">Take a quick interactive tour to see how you can earn rewards and stay connected with your care team</p>
                    <button onclick="startGuidedTour()" class="bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                        üöÄ Start Interactive Tour
                    </button>
                </div>
            </div>
            
            <button onclick="navigateTo('wallet')" class="w-full bg-teal-500 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:bg-teal-600 transition-colors">
                Skip Tour - See My Wallet
            </button>
        </section>

        <!-- Wallet Screen -->
        <section id="wallet" class="screen p-6 h-screen flex flex-col">
            <div class="mb-6">
                <button onclick="navigateTo('success')" class="text-teal-500 mb-4">‚Üê Back</button>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Your Reward Wallet</h2>
                <p class="text-sm text-gray-600">Earn points, spin the roulette, win prizes!</p>
            </div>
            
            <div class="bg-gradient-to-r from-teal-500 to-teal-600 rounded-xl p-6 text-white mb-6">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg">Total Points</span>
                    <span class="text-3xl font-bold">10</span>
                </div>
                <div class="text-center">
                    <button id="walletRouletteBtn" class="bg-gray-300 text-gray-600 px-6 py-2 rounded-full font-semibold opacity-75 cursor-not-allowed flex items-center justify-center mx-auto">
                        üîí Earn 15 more points to unlock spin
                    </button>
                </div>
            </div>

            <div class="flex-1">
                <h3 class="font-semibold mb-3">Recent Activity</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">‚úÖ</span>
                            <div>
                                <p class="font-semibold text-sm">Intake Complete</p>
                                <p class="text-xs text-gray-600">Just now</p>
                            </div>
                        </div>
                        <span class="text-green-600 font-semibold">+10</span>
                    </div>
                </div>
            </div>
            
            <button onclick="navigateTo('support')" class="w-full bg-teal-500 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:bg-teal-600 transition-colors">
                Continue Tour
            </button>
        </section>

        <!-- Support Group Screen -->
        <section id="support" class="screen p-6 h-screen flex flex-col">
            <div class="mb-6">
                <button onclick="navigateTo('wallet')" class="text-teal-500 mb-4">‚Üê Back</button>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Support Chat</h2>
                <p class="text-sm text-gray-600">Your care team and peers</p>
            </div>
            
            <div class="flex-1 space-y-3 mb-4" id="chatContainer">
                <div class="chat-bubble-received p-3">
                    <div class="flex items-start space-x-2">
                        <div class="w-6 h-6 bg-teal-500 rounded-full flex items-center justify-center text-white text-xs font-semibold">
                            C
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Cam (MSW)</p>
                            <p class="text-sm">Great job completing your intake!</p>
                        </div>
                    </div>
                </div>
                
                <div class="chat-bubble-received p-3">
                    <div class="flex items-start space-x-2">
                        <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-semibold">
                            A
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Alex (Peer)</p>
                            <p class="text-sm">üéâ Welcome to the team!</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-2 mb-4">
                <input type="text" id="messageInput" placeholder="Type a message..." class="flex-1 p-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-teal-500">
                <button onclick="sendMessage()" class="bg-teal-500 text-white px-4 py-3 rounded-full">
                    <span class="text-sm">Send</span>
                </button>
            </div>
            
            <button onclick="navigateTo('share')" class="w-full bg-teal-500 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:bg-teal-600 transition-colors">
                Continue Setup
            </button>
        </section>

        <!-- Share Consent Screen -->
        <section id="share" class="screen p-6 h-screen flex flex-col justify-center">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <span class="text-2xl">üë•</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Share Your Journey?</h2>
                <p class="text-gray-600">Invite a loved one to support your recovery journey. They'll get updates on your progress (only what you choose to share).</p>
            </div>
            
            <div class="space-y-4 mb-8">
                <button onclick="navigateTo('dashboard')" class="w-full bg-teal-500 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:bg-teal-600 transition-colors">
                    Yes, Add Support Person
                </button>
                <button onclick="navigateTo('dashboard')" class="w-full border border-gray-300 text-gray-700 py-4 px-6 rounded-xl text-lg font-semibold hover:bg-gray-50 transition-colors">
                    Skip For Now
                </button>
            </div>
        </section>

        <!-- Dashboard with Footer Navigation -->
        <section id="dashboard" class="screen h-screen flex flex-col">
            <!-- Dashboard Content Area -->
            <div class="flex-1 overflow-y-auto">
                <!-- My Team View -->
                <div id="team-view" class="dashboard-view p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">My Team</h2>
                    
                    <div class="space-y-4 mb-6">
                        <div class="bg-teal-50 rounded-lg p-4 border border-teal-200">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-teal-500 rounded-full flex items-center justify-center text-white font-semibold">
                                    C
                                </div>
                                <div>
                                    <p class="font-semibold">Cam Rodriguez</p>
                                    <p class="text-sm text-gray-600">MSW - Your Social Worker</p>
                                    <p class="text-xs text-teal-600">Online now</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold">
                                    A
                                </div>
                                <div>
                                    <p class="font-semibold">Alex Chen</p>
                                    <p class="text-sm text-gray-600">CPSS - Peer Support</p>
                                    <p class="text-xs text-gray-500">Last seen 2h ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="font-semibold mb-3">Support Network</h3>
                    <div class="bg-gray-100 rounded-lg p-4 text-center">
                        <p class="text-gray-600 text-sm">Add family or friends to your support network</p>
                        <button class="mt-2 text-teal-500 font-semibold">+ Add Support Person</button>
                    </div>
                </div>

                <!-- Group Therapy View -->
                <div id="therapy-view" class="dashboard-view p-6 hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Group Therapy</h2>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white mb-6">
                        <h3 class="text-lg font-semibold mb-2">Next Session</h3>
                        <p class="mb-4">Monday, 2:00 PM - Pod Alpha</p>
                        <button class="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold">
                            üìπ Join Waiting Room
                        </button>
                    </div>
                    
                    <div class="space-y-3">
                        <h3 class="font-semibold">Pod Members</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-gray-50 rounded-lg p-3 text-center">
                                <div class="w-8 h-8 bg-gray-400 rounded-full mx-auto mb-2"></div>
                                <p class="text-sm font-semibold">Sarah</p>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3 text-center">
                                <div class="w-8 h-8 bg-gray-400 rounded-full mx-auto mb-2"></div>
                                <p class="text-sm font-semibold">Mike</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drug Tests View -->
                <div id="tests-view" class="dashboard-view p-6 hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Drug Testing</h2>
                    
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white mb-6">
                        <h3 class="text-lg font-semibold mb-2">Daily Test Available</h3>
                        <p class="mb-4">Complete your saliva test with CPSS guidance</p>
                        <button onclick="startDrugTest()" class="bg-white text-green-600 px-6 py-3 rounded-lg font-semibold">
                            üß™ Start Guided Test
                        </button>
                    </div>
                    
                    <div class="space-y-3">
                        <h3 class="font-semibold">Recent Tests</h3>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <p class="text-gray-600 text-sm">No tests completed yet</p>
                            <p class="text-gray-500 text-xs mt-1">Complete your first test to earn 15 points!</p>
                        </div>
                    </div>
                </div>

                <!-- To-Dos View -->
                <div id="todos-view" class="dashboard-view p-6 hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Today's Activities</h2>
                    
                    <div class="space-y-4">
                        <div class="border border-orange-200 bg-orange-50 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold">Daily Check-in</p>
                                    <p class="text-sm text-gray-600">Share how you're feeling today</p>
                                </div>
                                <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-sm font-semibold">+5 pts</span>
                            </div>
                        </div>
                        
                        <div class="border border-green-200 bg-green-50 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold">Submit Saliva Test</p>
                                    <p class="text-sm text-gray-600">Complete your daily test</p>
                                </div>
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-semibold">+15 pts</span>
                            </div>
                        </div>
                        
                        <div class="border border-blue-200 bg-blue-50 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold">Attend Group Session</p>
                                    <p class="text-sm text-gray-600">Monday 2:00 PM session</p>
                                </div>
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-semibold">+20 pts</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Wallet View (Enhanced) -->
                <div id="wallet-view" class="dashboard-view p-6 hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Reward Wallet</h2>
                    
                    <div class="bg-gradient-to-r from-teal-500 to-teal-600 rounded-xl p-6 text-white mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg">Total Points</span>
                            <span class="text-3xl font-bold points-display">10</span>
                        </div>
                        <div class="text-center">
                            <button id="rouletteButton" class="bg-gray-300 text-gray-600 px-6 py-2 rounded-full font-semibold opacity-75 cursor-not-allowed flex items-center justify-center mx-auto">
                                üîí Earn 15 more points to unlock spin
                            </button>
                        </div>
                    </div>
                    
                    <h3 class="font-semibold mb-3">Completed Activities</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                            <div class="flex items-center">
                                <span class="text-xl mr-3">‚úÖ</span>
                                <div>
                                    <p class="font-semibold text-sm">Intake Complete</p>
                                    <p class="text-xs text-gray-600">Today</p>
                                </div>
                            </div>
                            <span class="text-green-600 font-semibold">+10</span>
                        </div>
                    </div>
                </div>

                <!-- Profile View -->
                <div id="profile-view" class="dashboard-view p-6 hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Profile</h2>
                    
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-teal-500 rounded-full mx-auto mb-4 flex items-center justify-center text-white text-2xl font-bold">
                            J
                        </div>
                        <h3 class="text-xl font-semibold">John Doe</h3>
                        <p class="text-gray-600">Member since today</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">Program Progress</h4>
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div>
                                    <p class="text-2xl font-bold text-teal-500">1</p>
                                    <p class="text-sm text-gray-600">Days Active</p>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-teal-500">10</p>
                                    <p class="text-sm text-gray-600">Points Earned</p>
                                </div>
                            </div>
                        </div>
                        
                        <button class="w-full text-red-500 py-3 border border-red-200 rounded-lg">
                            Emergency Support: (555) 123-4567
                        </button>
                    </div>
                </div>
            </div>

            <!-- Footer Navigation -->
            <div class="bg-white border-t border-gray-200 px-2 py-2">
                <div class="flex justify-around">
                    <button onclick="showDashboardView('team')" class="dashboard-tab flex flex-col items-center p-1 text-teal-500">
                        <span class="text-lg mb-1">üë•</span>
                        <span class="text-xs">Team</span>
                    </button>
                    <button onclick="showDashboardView('therapy')" class="dashboard-tab flex flex-col items-center p-1 text-gray-400">
                        <span class="text-lg mb-1">üí¨</span>
                        <span class="text-xs">Group</span>
                    </button>
                    <button onclick="showDashboardView('tests')" class="dashboard-tab flex flex-col items-center p-1 text-gray-400">
                        <span class="text-lg mb-1">üß™</span>
                        <span class="text-xs">Tests</span>
                    </button>
                    <button onclick="showDashboardView('todos')" class="dashboard-tab flex flex-col items-center p-1 text-gray-400">
                        <span class="text-lg mb-1">üìù</span>
                        <span class="text-xs">To-Do</span>
                    </button>
                    <button onclick="showDashboardView('wallet')" class="dashboard-tab flex flex-col items-center p-1 text-gray-400">
                        <span class="text-lg mb-1">üí∞</span>
                        <span class="text-xs">Wallet</span>
                    </button>
                    <button onclick="showDashboardView('profile')" class="dashboard-tab flex flex-col items-center p-1 text-gray-400">
                        <span class="text-lg mb-1">üë§</span>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </section>

    </div>

    <!-- Guided Tour Overlay -->
    <div id="tourOverlay" class="fixed inset-0 bg-black bg-opacity-70 hidden z-50">
        <!-- Tour Spotlight -->
        <div id="tourSpotlight" class="absolute bg-white bg-opacity-20 rounded-lg border-4 border-white shadow-2xl transition-all duration-500"></div>
        
        <!-- Tour Modal -->
        <div id="tourModal" class="absolute bg-white rounded-xl p-6 shadow-2xl w-80 max-w-[90vw] tour-modal">
            <div id="tourContent">
                <!-- Dynamic content loaded here -->
            </div>
            
            <div class="flex justify-between items-center mt-6">
                <div id="tourProgress" class="flex space-x-2">
                    <!-- Progress dots -->
                </div>
                
                <div class="space-x-3">
                    <button onclick="skipTour()" class="text-gray-500 px-3 py-2 rounded-lg hover:bg-gray-100 text-sm">
                        Skip
                    </button>
                    <button onclick="nextTourStep()" id="tourNextBtn" class="bg-teal-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-teal-600 text-sm">
                        Next
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Drug Test Simulation Modal -->
    <div id="drugTestModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="max-w-sm mx-auto bg-white h-full relative">
            
            <!-- Video Call Interface -->
            <div id="videoCall" class="test-step h-full flex flex-col">
                <div class="bg-black text-white p-4 flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm">Connected with CPSS</span>
                    </div>
                    <button onclick="closeDrugTest()" class="text-white">‚úï</button>
                </div>
                
                <div class="flex-1 bg-gray-900 relative">
                    <!-- Mock video feed -->
                    <div class="absolute inset-4 bg-blue-900 rounded-lg flex items-center justify-center">
                        <div class="text-center text-white">
                            <div class="w-16 h-16 bg-blue-600 rounded-full mx-auto mb-2 flex items-center justify-center">
                                <span class="text-2xl">üë®‚Äç‚öïÔ∏è</span>
                            </div>
                            <p class="text-sm">Zack (CPSS)</p>
                        </div>
                    </div>
                    
                    <!-- Patient video (small corner) -->
                    <div class="absolute top-4 right-4 w-20 h-28 bg-teal-700 rounded-lg flex items-center justify-center">
                        <span class="text-white text-2xl">üë§</span>
                    </div>
                </div>
                
                <div class="p-4 bg-white">
                    <div class="bg-blue-50 p-3 rounded-lg mb-4">
                        <p class="text-sm text-blue-800">"Hi! I'm here to guide you through your first saliva test. Let's start by showing me the tamper-proof seal on your test kit."</p>
                    </div>
                    <button onclick="nextTestStep('seal')" class="w-full bg-teal-500 text-white py-3 rounded-lg font-semibold">
                        Show Seal & QR Code
                    </button>
                </div>
            </div>

            <!-- QR Code/Seal Step -->
            <div id="sealStep" class="test-step hidden h-full flex flex-col">
                <div class="bg-teal-500 text-white p-4 flex items-center justify-between">
                    <span class="font-semibold">Verify Test Kit</span>
                    <button onclick="closeDrugTest()" class="text-white">‚úï</button>
                </div>
                
                <div class="flex-1 p-6 flex flex-col justify-center">
                    <div class="text-center mb-6">
                        <div class="w-32 h-32 bg-gray-200 rounded-lg mx-auto mb-4 flex items-center justify-center border-2 border-dashed border-gray-400">
                            <div class="text-center">
                                <div class="text-4xl mb-2">üì±</div>
                                <p class="text-xs text-gray-600">QR Code</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">Show the QR code and tamper-proof seal to your camera</p>
                    </div>
                    
                    <div class="bg-green-50 p-3 rounded-lg mb-4">
                        <p class="text-sm text-green-800">"Perfect! I can see the seal is intact and the QR code confirms this is your assigned test kit. Now let's collect the sample."</p>
                    </div>
                </div>
                
                <div class="p-4">
                    <button onclick="nextTestStep('sample')" class="w-full bg-teal-500 text-white py-3 rounded-lg font-semibold">
                        Collect Sample
                    </button>
                </div>
            </div>

            <!-- Sample Collection Step -->
            <div id="sampleStep" class="test-step hidden h-full flex flex-col">
                <div class="bg-teal-500 text-white p-4 flex items-center justify-between">
                    <span class="font-semibold">Collect Sample</span>
                    <button onclick="closeDrugTest()" class="text-white">‚úï</button>
                </div>
                
                <div class="flex-1 p-6 flex flex-col justify-center">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">üß™</div>
                        <h3 class="text-lg font-semibold mb-2">Saliva Collection</h3>
                        <p class="text-sm text-gray-600">Follow the instructions on your test kit</p>
                    </div>
                    
                    <div class="bg-blue-50 p-3 rounded-lg mb-4">
                        <p class="text-sm text-blue-800">"Take your time. Fill the collection tube to the line. I'm here if you have any questions!"</p>
                    </div>
                </div>
                
                <div class="p-4">
                    <button onclick="nextTestStep('waiting')" class="w-full bg-teal-500 text-white py-3 rounded-lg font-semibold">
                        Sample Complete
                    </button>
                </div>
            </div>

            <!-- Waiting/Coaching Step -->
            <div id="waitingStep" class="test-step hidden h-full flex flex-col">
                <div class="bg-yellow-500 text-white p-4 flex items-center justify-between">
                    <span class="font-semibold">Processing Results</span>
                    <button onclick="closeDrugTest()" class="text-white">‚úï</button>
                </div>
                
                <div class="flex-1 p-6 flex flex-col justify-center">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-yellow-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                            <div class="animate-spin text-2xl">‚è≥</div>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Processing...</h3>
                        <p class="text-sm text-gray-600">Results typically take 2-3 minutes</p>
                    </div>
                    
                    <div class="bg-green-50 p-3 rounded-lg mb-4">
                        <p class="text-sm text-green-800">"Great job! While we wait, let's do some breathing exercises. Take a deep breath in... and slowly out. You're doing amazing!"</p>
                    </div>
                </div>
                
                <div class="p-4">
                    <button onclick="nextTestStep('results')" class="w-full bg-yellow-500 text-white py-3 rounded-lg font-semibold">
                        Show Results
                    </button>
                </div>
            </div>

            <!-- Results Step -->
            <div id="resultsStep" class="test-step hidden h-full flex flex-col">
                <div class="bg-green-500 text-white p-4 flex items-center justify-between">
                    <span class="font-semibold">Test Results</span>
                    <button onclick="closeDrugTest()" class="text-white">‚úï</button>
                </div>
                
                <div class="flex-1 p-6 flex flex-col justify-center">
                    <div class="text-center mb-6">
                        <div class="text-8xl mb-4">üéâ</div>
                        <h3 class="text-2xl font-bold text-green-600 mb-2">NEGATIVE!</h3>
                        <p class="text-lg text-gray-600">Congratulations!</p>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-green-800 text-center">"AMAZING! Let's celebrate! üéä This is fantastic progress!"</p>
                    </div>
                    
                    <div class="points-badge text-white py-3 px-6 rounded-full text-center mb-4">
                        <span class="font-bold text-lg">+15 Points Earned!</span>
                    </div>
                </div>
                
                <div class="p-4">
                    <button onclick="completeDrugTest()" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold">
                        Awesome! Continue
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Roulette Modal -->
    <div id="rouletteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="max-w-sm mx-auto bg-white h-full flex flex-col justify-center p-6">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Reward Roulette!</h2>
                <p class="text-gray-600">You've earned enough points to spin!</p>
            </div>
            
            <div class="relative mb-8">
                <!-- Roulette Wheel -->
                <div id="rouletteWheel" class="roulette-wheel mx-auto">
                    <!-- Center dot -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="w-4 h-4 bg-white rounded-full z-10"></div>
                    </div>
                    
                    <!-- Numbers that spin with the wheel -->
                    <div class="roulette-numbers">
                        <div class="roulette-number">$5</div>
                        <div class="roulette-number">$10</div>
                        <div class="roulette-number">$5</div>
                        <div class="roulette-number">$15</div>
                        <div class="roulette-number">$5</div>
                        <div class="roulette-number">$10</div>
                        <div class="roulette-number">$5</div>
                        <div class="roulette-number">$25</div>
                        <div class="roulette-number">$5</div>
                        <div class="roulette-number">$30</div>
                    </div>
                </div>
                
                <!-- Pointer -->
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1 z-20">
                    <div class="w-0 h-0 border-l-4 border-r-4 border-b-8 border-l-transparent border-r-transparent border-b-gray-800"></div>
                </div>
            </div>
            
            <button onclick="spinRoulette()" id="spinButton" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 rounded-xl text-lg font-bold">
                üé∞ Tap to spin now! üé∞
            </button>
            
            <div id="spinResult" class="hidden mt-6 text-center">
                <div class="text-6xl mb-2">üéä</div>
                <h3 class="text-3xl font-bold text-green-600 mb-2" id="winAmount">YOU WON $30!</h3>
                <p class="text-gray-600 mb-4">Amazing! Check your rewards wallet</p>
                <button onclick="closeRoulette()" class="bg-teal-500 text-white px-6 py-3 rounded-lg font-semibold">
                    Collect Winnings
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentPoints = 10; // Starting points from intake
        let hasCompletedTest = false;
        let currentTourStep = 0;

        // Guided Tour Steps
        const tourSteps = [
            {
                title: "Welcome to Moonlit! üåô",
                content: "You've earned your first 10 points! In Moonlit, everything you do earns points that turn into real cash rewards. Let's explore how it works.",
                target: null,
                position: "center",
                action: "highlight-points"
            },
            {
                title: "Drug Testing Made Easy üß™",
                content: "Tap the Tests tab to see how our guided drug testing works. Your CPSS will walk you through every step via video call.",
                target: "button[onclick=\"showDashboardView('tests')\"]",
                position: "top",
                action: "show-dashboard"
            },
            {
                title: "Complete Your First Test üì±",
                content: "This is where you'll do guided saliva tests with your care team. Each negative test earns 15 points - let's try it!",
                target: "button[onclick=\"startDrugTest()\"]",
                position: "bottom",
                action: "start-test"
            },
            {
                title: "Your Reward Wallet üí∞",
                content: "Great! You now have 25 points total. Your wallet tracks all your achievements and lets you spend points on real rewards.",
                target: "button[onclick=\"showDashboardView('wallet')\"]",
                position: "top",
                action: "show-wallet"
            },
            {
                title: "Spin the Roulette! üé∞",
                content: "You have enough points to spin! Our rewards roulette gives you cash prizes. Each spin costs 25 points but can win up to $50!",
                target: "#rouletteButton",
                position: "top",
                action: "spin-roulette"
            },
            {
                title: "Your Care Team üë•",
                content: "Your Team tab connects you with your CPSS and MSW. They're here to support you every step of your recovery journey.",
                target: "button[onclick=\"showDashboardView('team')\"]",
                position: "top",
                action: "show-team"
            },
            {
                title: "You're All Set! üéâ",
                content: "You've completed the Moonlit tour! You now know how to earn points, complete tests, win rewards, and connect with your care team. Ready to start your recovery journey?",
                target: null,
                position: "center",
                action: "complete"
            }
        ];

        // Guided Tour Functions
        function startGuidedTour() {
            currentTourStep = 0;
            document.getElementById('tourOverlay').classList.remove('hidden');
            navigateTo('dashboard'); // Move to dashboard for tour
            setTimeout(() => {
                showTourStep(0);
            }, 500);
            logEvent('GUIDED_TOUR_STARTED', 'SUCCESS');
        }

        function showTourStep(stepIndex) {
            const step = tourSteps[stepIndex];
            const tourContent = document.getElementById('tourContent');
            const tourModal = document.getElementById('tourModal');
            const tourSpotlight = document.getElementById('tourSpotlight');
            const nextBtn = document.getElementById('tourNextBtn');

            // Update content
            tourContent.innerHTML = `
                <h3 class="text-xl font-bold text-gray-800 mb-3">${step.title}</h3>
                <p class="text-gray-600">${step.content}</p>
            `;

            // Update progress dots
            updateTourProgress(stepIndex);

            // Update next button
            nextBtn.textContent = stepIndex === tourSteps.length - 1 ? 'Finish' : 'Next';

            // Position modal and spotlight
            if (step.target) {
                const targetElement = document.querySelector(step.target);
                if (targetElement) {
                    const rect = targetElement.getBoundingClientRect();
                    
                    // Position spotlight
                    tourSpotlight.style.left = (rect.left - 10) + 'px';
                    tourSpotlight.style.top = (rect.top - 10) + 'px';
                    tourSpotlight.style.width = (rect.width + 20) + 'px';
                    tourSpotlight.style.height = (rect.height + 20) + 'px';
                    tourSpotlight.classList.remove('hidden');
                    
                    // Position modal
                    if (step.position === 'top') {
                        tourModal.style.left = Math.max(20, Math.min(window.innerWidth - 340, rect.left - 100)) + 'px';
                        tourModal.style.top = Math.max(20, rect.top - 220) + 'px';
                        tourModal.style.transform = 'none';
                    } else if (step.position === 'bottom') {
                        tourModal.style.left = Math.max(20, Math.min(window.innerWidth - 340, rect.left - 100)) + 'px';
                        tourModal.style.top = Math.min(window.innerHeight - 250, rect.bottom + 20) + 'px';
                        tourModal.style.transform = 'none';
                    }
                } else {
                    tourSpotlight.classList.add('hidden');
                }
            } else {
                // Center modal for steps without targets
                tourSpotlight.classList.add('hidden');
                tourModal.style.left = '50%';
                tourModal.style.top = '50%';
                tourModal.style.transform = 'translate(-50%, -50%)';
            }

            // Execute step action
            executeStepAction(step.action);
        }

        function executeStepAction(action) {
            switch(action) {
                case 'show-dashboard':
                    // Already on dashboard
                    break;
                case 'start-test':
                    showDashboardView('tests');
                    break;
                case 'show-wallet':
                    // Simulate completing test
                    if (!hasCompletedTest) {
                        currentPoints += 15;
                        hasCompletedTest = true;
                        updateWalletDisplay();
                        updateTestsView();
                    }
                    showDashboardView('wallet');
                    break;
                case 'spin-roulette':
                    // Will be handled by user click
                    break;
                case 'show-team':
                    showDashboardView('team');
                    break;
                case 'complete':
                    // Tour completion
                    break;
            }
        }

        function updateTourProgress(currentStep) {
            const progressContainer = document.getElementById('tourProgress');
            const dots = tourSteps.map((_, index) => {
                const active = index <= currentStep ? 'bg-teal-500' : 'bg-gray-300';
                return `<div class="w-3 h-3 rounded-full ${active}"></div>`;
            }).join('');
            progressContainer.innerHTML = dots;
        }

        function nextTourStep() {
            if (currentTourStep < tourSteps.length - 1) {
                currentTourStep++;
                showTourStep(currentTourStep);
                logEvent('TOUR_STEP_' + currentTourStep, 'GUIDED_TOUR');
            } else {
                completeTour();
            }
        }

        function skipTour() {
            completeTour();
            logEvent('TOUR_SKIPPED', 'GUIDED_TOUR');
        }

        function completeTour() {
            document.getElementById('tourOverlay').classList.add('hidden');
            // Ensure they're on a good ending screen
            showDashboardView('wallet');
            logEvent('TOUR_COMPLETED', 'GUIDED_TOUR');
        }

        // Analytics function
        function logEvent(action, screen) {
            console.log(`[REACH Analytics] ${action} - Screen: ${screen} - Time: ${new Date().toISOString()}`);
        }

        // Navigation function with smooth transitions
        function navigateTo(screenId) {
            const currentScreen = document.querySelector('.screen.active');
            const nextScreen = document.getElementById(screenId);
            
            // Log the navigation event
            logEvent('NAVIGATE', screenId.toUpperCase());
            
            // Fade out current screen
            currentScreen.classList.remove('active');
            
            // Fade in next screen after a short delay
            setTimeout(() => {
                nextScreen.classList.add('active');
                nextScreen.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 150);
        }

        // Dashboard tab navigation
        function showDashboardView(viewName) {
            // Hide all dashboard views
            document.querySelectorAll('.dashboard-view').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show selected view
            document.getElementById(viewName + '-view').classList.remove('hidden');
            
            // Update tab states
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.classList.remove('text-teal-500');
                tab.classList.add('text-gray-400');
            });
            
            // Highlight active tab
            if (event && event.target) {
                event.target.closest('.dashboard-tab').classList.remove('text-gray-400');
                event.target.closest('.dashboard-tab').classList.add('text-teal-500');
            }
            
            logEvent('TAB_SWITCH', viewName.toUpperCase());
        }

        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const container = document.getElementById('chatContainer');
            
            if (input.value.trim()) {
                // Create sent message bubble
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-bubble-sent p-3';
                messageDiv.innerHTML = `<p class="text-sm">${input.value}</p>`;
                
                container.appendChild(messageDiv);
                input.value = '';
                
                // Scroll to bottom
                container.scrollTop = container.scrollHeight;
                
                logEvent('MESSAGE_SENT', 'SUPPORT_CHAT');
            }
        }

        // Allow Enter key to send message
        document.addEventListener('DOMContentLoaded', function() {
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });

        // Log button clicks
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'BUTTON') {
                const buttonText = e.target.textContent.trim();
                const currentScreen = document.querySelector('.screen.active').id;
                logEvent(`BUTTON_CLICK: ${buttonText}`, currentScreen.toUpperCase());
            }
        });

        // Drug test simulation functions
        function startDrugTest() {
            document.getElementById('drugTestModal').classList.remove('hidden');
            document.getElementById('videoCall').classList.remove('hidden');
            logEvent('DRUG_TEST_STARTED', 'TESTS');
        }

        function nextTestStep(step) {
            // Hide current step
            document.querySelectorAll('.test-step').forEach(el => el.classList.add('hidden'));
            
            // Show next step
            if (step === 'seal') {
                document.getElementById('sealStep').classList.remove('hidden');
            } else if (step === 'sample') {
                document.getElementById('sampleStep').classList.remove('hidden');
            } else if (step === 'waiting') {
                document.getElementById('waitingStep').classList.remove('hidden');
            } else if (step === 'results') {
                document.getElementById('resultsStep').classList.remove('hidden');
            }
            
            logEvent('TEST_STEP_' + step.toUpperCase(), 'DRUG_TEST');
        }

        function completeDrugTest() {
            // Award points
            currentPoints += 15;
            hasCompletedTest = true;
            
            // Update wallet view
            updateWalletDisplay();
            updateTestsView();
            
            // Close modal and switch to wallet
            closeDrugTest();
            showDashboardView('wallet');
            
            logEvent('DRUG_TEST_COMPLETED', 'TESTS');
        }

        function closeDrugTest() {
            document.getElementById('drugTestModal').classList.add('hidden');
            document.querySelectorAll('.test-step').forEach(el => el.classList.add('hidden'));
            document.getElementById('videoCall').classList.remove('hidden');
        }

        function updateWalletDisplay() {
            // Update points display
            document.querySelectorAll('.points-display').forEach(el => {
                el.textContent = currentPoints;
            });
            
            // Update roulette buttons
            updateRouletteButton();
            updateWalletRouletteButton();
            
            // Update recent activity if test completed
            if (hasCompletedTest) {
                const walletView = document.getElementById('wallet-view');
                const activitySection = walletView.querySelector('.space-y-3');
                activitySection.innerHTML = `
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">‚úÖ</span>
                            <div>
                                <p class="font-semibold text-sm">Drug Test Complete</p>
                                <p class="text-xs text-gray-600">Just now</p>
                            </div>
                        </div>
                        <span class="text-green-600 font-semibold">+15</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">‚úÖ</span>
                            <div>
                                <p class="font-semibold text-sm">Intake Complete</p>
                                <p class="text-xs text-gray-600">Earlier today</p>
                            </div>
                        </div>
                        <span class="text-green-600 font-semibold">+10</span>
                    </div>
                `;
            }
        }

        function updateTestsView() {
            if (hasCompletedTest) {
                const testsView = document.getElementById('tests-view');
                const recentTests = testsView.querySelector('.space-y-3');
                recentTests.innerHTML = `
                    <h3 class="font-semibold">Recent Tests</h3>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">‚úÖ</span>
                            <div>
                                <p class="font-semibold text-sm">Saliva Test - NEGATIVE</p>
                                <p class="text-xs text-gray-600">Just completed</p>
                            </div>
                        </div>
                        <span class="text-green-600 font-semibold">+15 pts</span>
                    </div>
                `;
                
                // Update the main test button
                const testButton = testsView.querySelector('.bg-gradient-to-r');
                testButton.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2">Great Job!</h3>
                    <p class="mb-4">Next test available tomorrow</p>
                    <button class="bg-white text-green-600 px-6 py-3 rounded-lg font-semibold opacity-50" disabled>
                        üß™ Test Completed Today
                    </button>
                `;
            }
        }

        // Update main wallet roulette button 
        function updateWalletRouletteButton() {
            const button = document.getElementById('walletRouletteBtn');
            if (currentPoints >= 25) {
                button.textContent = 'üéâ You\'ve earned enough points to spin!';
                button.onclick = function() { 
                    document.getElementById('rouletteModal').classList.remove('hidden');
                    logEvent('ROULETTE_OPENED', 'WALLET');
                };
                button.classList.remove('bg-gray-300', 'text-gray-600', 'opacity-75', 'cursor-not-allowed');
                button.classList.add('bg-white', 'text-teal-600', 'hover:bg-gray-100', 'cursor-pointer');
            } else {
                const needed = 25 - currentPoints;
                button.textContent = `üîí Earn ${needed} more points to unlock spin`;
                button.onclick = function() {
                    // Show helpful message
                    const originalText = button.textContent;
                    button.textContent = `Keep going! ${needed} more points needed!`;
                    setTimeout(() => {
                        button.textContent = originalText;
                    }, 2000);
                };
                button.classList.remove('bg-white', 'text-teal-600', 'hover:bg-gray-100', 'cursor-pointer');
                button.classList.add('bg-gray-300', 'text-gray-600', 'opacity-75', 'cursor-not-allowed');
            }
        }

        // Update dashboard wallet roulette button
        function updateRouletteButton() {
            const button = document.getElementById('rouletteButton');
            if (currentPoints >= 25) {
                button.textContent = 'üéâ You\'ve earned enough points to spin!';
                button.onclick = function() { 
                    document.getElementById('rouletteModal').classList.remove('hidden');
                    logEvent('ROULETTE_OPENED', 'WALLET');
                };
                button.classList.remove('bg-gray-300', 'text-gray-600', 'opacity-75', 'cursor-not-allowed');
                button.classList.add('bg-white', 'text-teal-600', 'hover:bg-gray-100', 'cursor-pointer');
            } else {
                const needed = 25 - currentPoints;
                button.textContent = `üîí Earn ${needed} more points to unlock spin`;
                button.onclick = function() {
                    // Show helpful message
                    const originalText = button.textContent;
                    button.textContent = `Keep going! ${needed} more points needed!`;
                    setTimeout(() => {
                        button.textContent = originalText;
                    }, 2000);
                };
                button.classList.remove('bg-white', 'text-teal-600', 'hover:bg-gray-100', 'cursor-pointer');
                button.classList.add('bg-gray-300', 'text-gray-600', 'opacity-75', 'cursor-not-allowed');
            }
        }

        function closeRoulette() {
            document.getElementById('rouletteModal').classList.add('hidden');
            // Reset roulette for next time
            const wheel = document.getElementById('rouletteWheel');
            wheel.style.transform = 'rotate(0deg)';
            wheel.style.transition = 'none';
            setTimeout(() => {
                wheel.style.transition = 'transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            }, 100);
            
            document.getElementById('spinResult').classList.add('hidden');
            document.getElementById('spinButton').classList.remove('hidden');
            document.getElementById('spinButton').disabled = false;
            document.getElementById('spinButton').textContent = 'üé∞ Tap to spin now! üé∞';
        }

// Roulette spin function with proper probabilities and visual feedback
function spinRoulette() {
    const wheel = document.getElementById('rouletteWheel');
    const button = document.getElementById('spinButton');
    
    // Disable button and start spinning
    button.disabled = true;
    button.textContent = 'üé∞ SPINNING... üé∞';
    
    // Define wheel sections with their center angles and prizes
    const wheelSections = [
        { angle: 18, prize: 5 },   // $5 section 1
        { angle: 54, prize: 10 },  // $10 section 1
        { angle: 90, prize: 5 },   // $5 section 2
        { angle: 126, prize: 15 }, // $15 section
        { angle: 162, prize: 5 },  // $5 section 3
        { angle: 198, prize: 10 }, // $10 section 2
        { angle: 234, prize: 5 },  // $5 section 4
        { angle: 270, prize: 25 }, // $25 section
        { angle: 306, prize: 5 },  // $5 section 5
        { angle: 342, prize: 30 }  // $30 section
    ];
    
    // Determine winning section based on probabilities
    const rand = Math.random();
    let winningSection;
    
    if (rand < 0.1) {
        // 10% chance: $30
        winningSection = wheelSections[9]; // $30 section
    } else if (rand < 0.2) {
        // 10% chance: $25
        winningSection = wheelSections[7]; // $25 section
    } else if (rand < 0.3) {
        // 10% chance: $15
        winningSection = wheelSections[3]; // $15 section
    } else if (rand < 0.5) {
        // 20% chance: $10
        const tenSections = [wheelSections[1], wheelSections[5]]; // $10 sections
        winningSection = tenSections[Math.floor(Math.random() * tenSections.length)];
    } else {
        // 50% chance: $5
        const fiveSections = [wheelSections[0], wheelSections[2], wheelSections[4], wheelSections[6], wheelSections[8]]; // $5 sections
        winningSection = fiveSections[Math.floor(Math.random() * fiveSections.length)];
    }
    
    // Calculate final rotation (multiple spins + landing on winning section)
    // Pointer is at top (0¬∞), so we need to account for that
    const finalRotation = 1800 + (360 - winningSection.angle); // 5 full rotations + position
    
    // Add spinning animation
    wheel.style.transform = `rotate(${finalRotation}deg)`;
    
    // Show result after spin
    setTimeout(() => {
        document.getElementById('winAmount').textContent = `YOU WON $${winningSection.prize}!`;
        document.getElementById('spinResult').classList.remove('hidden');
        button.classList.add('hidden');
        currentPoints -= 25; // Deduct spin cost
        updateWalletDisplay(); // Update points display
        logEvent(`ROULETTE_WON_$${winningSection.prize}`, 'WALLET');
    }, 3000);
    
    logEvent('ROULETTE_SPIN', 'WALLET');
}

        function checkEligibility() {
            const input = document.getElementById('medicaidInput');
            const result = document.getElementById('eligibilityResult');
            
            if (input.value.trim()) {
                // Simulate API call delay
                result.innerHTML = '<div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg"><p class="text-yellow-700">üîÑ Checking eligibility...</p></div>';
                result.classList.remove('hidden');
                
                setTimeout(() => {
                    // Mock successful result
                    result.innerHTML = `
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <span class="text-green-600">‚úÖ</span>
                                <div class="text-sm">
                                    <p class="font-semibold text-green-800">Eligible - Targeted Adult Medicaid</p>
                                    <p class="text-green-600">Route: FFS Medicaid (H0038)</p>
                                    <p class="text-green-600">County: Salt Lake | No PMHP enrollment</p>
                                </div>
                            </div>
                        </div>
                    `;
                    logEvent('MEDICAID_VERIFIED', 'INTAKE');
                }, 1500);
            }
        }

        // Log page load and initialize
        window.addEventListener('load', function() {
            logEvent('PAGE_LOAD', 'WELCOME');
            // Initialize roulette buttons
            setTimeout(() => {
                updateRouletteButton();
                updateWalletRouletteButton();
            }, 1000);
        });
    </script>
</body>
</html>
